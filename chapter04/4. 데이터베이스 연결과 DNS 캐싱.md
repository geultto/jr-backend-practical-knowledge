## 4.1 DB í˜ì¼ì˜¤ë²„ ì‹œë‚˜ë¦¬ì˜¤

### Multi-AZì™€ Aurora ìë™ í˜ì¼ì˜¤ë²„

í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ê³ ê°€ìš©ì„±ì„ ìœ„í•´ Multi-AZ(Multi-Availability Zone) ë˜ëŠ” AWS Auroraì™€ ê°™ì€ ìë™ í˜ì¼ì˜¤ë²„ ì†”ë£¨ì…˜ì„ ì‚¬ìš©í•œë‹¤. ì´ëŸ¬í•œ í™˜ê²½ì—ì„œëŠ” ì£¼ ë°ì´í„°ë² ì´ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ì— ì¥ì• ê°€ ë°œìƒí•˜ë©´, ìë™ìœ¼ë¡œ ëŒ€ê¸° ì¸ìŠ¤í„´ìŠ¤(Standby)ë¡œ ì „í™˜ëœë‹¤.

```mermaid
sequenceDiagram
    participant App as Application
    participant DNS as DNS Server
    participant Primary as Primary DB<br/>(10.0.1.10)
    participant Standby as Standby DB<br/>(10.0.1.20)

    Note over App,Standby: ì •ìƒ ìš´ì˜ ìƒíƒœ
    App->>DNS: db.example.com ì¡°íšŒ
    DNS-->>App: 10.0.1.10 (Primary)
    App->>Primary: SQL Query
    Primary-->>App: Response

    Note over Primary: âŒ Primary ì¥ì•  ë°œìƒ
    Note over Standby: Standbyê°€ Primaryë¡œ ìŠ¹ê²©

    App->>DNS: db.example.com ì¡°íšŒ
    DNS-->>App: 10.0.1.20 (New Primary)
    App->>Standby: SQL Query
    Standby-->>App: Response
```

### DNS ì—”ë“œí¬ì¸íŠ¸ ê¸°ë°˜ ì ‘ì†

ëŒ€ë¶€ë¶„ì˜ ê´€ë¦¬í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê³ ì • IPê°€ ì•„ë‹Œ DNS ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì œê³µí•œë‹¤

- **AWS RDS**: `mydb.123456.us-east-1.rds.amazonaws.com`
- **AWS Aurora**: `mydb-cluster.cluster-123456.us-east-1.rds.amazonaws.com`
- **Google Cloud SQL**: `mydb.project-id.cloudsql.goog`
- **Azure Database**: `mydb.mysql.database.azure.com`

í˜ì¼ì˜¤ë²„ ë°œìƒ ì‹œ DNS ë ˆì½”ë“œê°€ ìƒˆë¡œìš´ Primary ì¸ìŠ¤í„´ìŠ¤ì˜ IPë¡œ ì—…ë°ì´íŠ¸ëœë‹¤.

```mermaid
graph TB
    subgraph "í˜ì¼ì˜¤ë²„ ì „"
        DNS1[DNS: db.example.com] -->|10.0.1.10| P1[Primary DB<br/>10.0.1.10]
        DNS1 -.->|ëŒ€ê¸°| S1[Standby DB<br/>10.0.1.20]
    end

    subgraph "í˜ì¼ì˜¤ë²„ í›„"
        DNS2[DNS: db.example.com] -->|10.0.1.20| P2[New Primary DB<br/>10.0.1.20]
        DNS2 -.->|ì¤‘ë‹¨ë¨| S2[Old Primary DB<br/>10.0.1.10 âŒ]
    end

    style P1 fill:#90EE90
    style S1 fill:#FFE4B5
    style P2 fill:#90EE90
    style S2 fill:#FFB6C6
```

AWS Auroraì˜ ê²½ìš° í˜ì¼ì˜¤ë²„ëŠ” ë³´í†µ **60~90ì´ˆ** ì´ë‚´ì— ì™„ë£Œëœë‹¤
1. **ì¥ì•  ê°ì§€**: 10~15ì´ˆ
2. **Standby ìŠ¹ê²©**: 20~30ì´ˆ
3. **DNS ì—…ë°ì´íŠ¸**: ì¦‰ì‹œ (í•˜ì§€ë§Œ ìºì‹œ ë¬¸ì œê°€ ë°œìƒ)
4. **ì• í”Œë¦¬ì¼€ì´ì…˜ ë³µêµ¬**: DNS ìºì‹œì— ë”°ë¼ ë‹¬ë¼ì§

---

## 4.2 DNS ìºì‹± ë¬¸ì œ

### JVM DNS ìºì‹œ ë©”ì»¤ë‹ˆì¦˜

JVMì€ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ DNS ì¡°íšŒ ê²°ê³¼ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ìºì‹±í•œë‹¤. ì´ëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ì¤„ì—¬ì£¼ì§€ë§Œ, í˜ì¼ì˜¤ë²„ ìƒí™©ì—ì„œëŠ” ì¹˜ëª…ì ì¸ ë¬¸ì œê°€ ëœë‹¤.

```mermaid
sequenceDiagram
    participant App as JVM Application
    participant Cache as JVM DNS Cache
    participant DNS as DNS Server
    participant OldDB as Old Primary DB<br/>(10.0.1.10) âŒ
    participant NewDB as New Primary DB<br/>(10.0.1.20)

    Note over App,NewDB: í˜ì¼ì˜¤ë²„ ë°œìƒ ì „ - ì •ìƒ ìš´ì˜
    App->>Cache: db.example.com ì¡°íšŒ
    Cache->>DNS: DNS Query
    DNS-->>Cache: 10.0.1.10
    Cache-->>App: 10.0.1.10 (ìºì‹œ ì €ì¥, TTL=30ì´ˆ)
    App->>OldDB: ì—°ê²° ì„±ê³µ

    Note over OldDB: âŒ Primary ì¥ì•  ë°œìƒ
    Note over DNS,NewDB: DNSê°€ 10.0.1.20ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¨

    Note over App,NewDB: í˜ì¼ì˜¤ë²„ ë°œìƒ í›„ - ìºì‹œ ë¬¸ì œ
    App->>Cache: db.example.com ì¡°íšŒ
    Cache-->>App: 10.0.1.10 (ìºì‹œ íˆíŠ¸! âš ï¸ êµ¬ IP ë°˜í™˜)
    App->>OldDB: ì—°ê²° ì‹œë„
    OldDB--xApp: Connection Timeout (2ì´ˆ)

    Note over Cache: ìºì‹œ ë§Œë£Œê¹Œì§€ 28ì´ˆ ë‚¨ìŒ...

    App->>Cache: ì¬ì‹œë„
    Cache-->>App: 10.0.1.10 (ì—¬ì „íˆ ìºì‹œ íˆíŠ¸)
    App->>OldDB: ì—°ê²° ì‹œë„
    OldDB--xApp: Connection Timeout (2ì´ˆ)

    Note over App: ë°˜ë³µì ì¸ ì‹¤íŒ¨... ğŸ”´

    Note over Cache: ... 28ì´ˆ í›„ ìºì‹œ ë§Œë£Œ ...

    App->>Cache: db.example.com ì¡°íšŒ
    Cache->>DNS: DNS Query (ìºì‹œ ë§Œë£Œ)
    DNS-->>Cache: 10.0.1.20 (ìƒˆ IP)
    Cache-->>App: 10.0.1.20
    App->>NewDB: ì—°ê²° ì„±ê³µ âœ…
```

## 4.3 1ì´ˆ TTL ì„¤ì • ê¶Œì¥

### JVM DNS ìºì‹œ TTL ì„¤ì • ë°©ë²•

#### ë°©ë²• 1: ì½”ë“œë¡œ ì„¤ì •

```java
import java.security.Security;

@Configuration
public class DnsConfig {

    @PostConstruct
    public void configureDnsCache() {
        // ì„±ê³µí•œ DNS ì¡°íšŒ ê²°ê³¼ë¥¼ 1ì´ˆê°„ ìºì‹±
        Security.setProperty("networkaddress.cache.ttl", "1");

        // ì‹¤íŒ¨í•œ DNS ì¡°íšŒ ê²°ê³¼ë„ 1ì´ˆê°„ ìºì‹±
        Security.setProperty("networkaddress.cache.negative.ttl", "1");

        // ì„¤ì • í™•ì¸ ë¡œê¹…
        String positiveTtl = Security.getProperty("networkaddress.cache.ttl");
        String negativeTtl = Security.getProperty("networkaddress.cache.negative.ttl");

        log.info("DNS Cache TTL configured - Positive: {}s, Negative: {}s",
                 positiveTtl, negativeTtl);
    }
}
```

#### ë°©ë²• 2: JVM ì‹œìŠ¤í…œ í”„ë¡œí¼í‹°

```bash
java -Dsun.net.inetaddr.ttl=1 \
     -Dsun.net.inetaddr.negative.ttl=1 \
     -jar myapp.jar
```


---

## 4.4 1ì´ˆ TTLì˜ ì„±ëŠ¥ ì˜í–¥

### ì„±ëŠ¥ ì˜í–¥ ì‹œë®¬ë ˆì´ì…˜

**ì‹œë‚˜ë¦¬ì˜¤**: ì´ˆë‹¹ 1,000 ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜

```mermaid
graph TB
    subgraph "1ì´ˆë‹¹ 1,000ê°œ ìš”ì²­ ì²˜ë¦¬"
        A[1,000ê°œ ìš”ì²­] --> B{ì²« ë²ˆì§¸ ìš”ì²­ì¸ê°€?}
        B -->|Yes| C[DNS ì¡°íšŒ ìˆ˜í–‰<br/>15ms]
        B -->|No| D[ìºì‹œ ì‚¬ìš©<br/>0ms]
        C --> E[999ê°œ ìš”ì²­ì€<br/>ìºì‹œ ì‚¬ìš©]
        D --> E
    end
```

**ê²°ë¡ **: TTL=1ì´ˆ ì„¤ì •ì€ **ì‹¤ì§ˆì ì¸ ì„±ëŠ¥ ì˜í–¥ì´ ê±°ì˜ ì—†ë‹¤**.

- 1ì´ˆì— 1ë²ˆë§Œ ì‹¤ì œ DNS ì¡°íšŒ ë°œìƒ
- ë‚˜ë¨¸ì§€ 999ë²ˆì˜ ìš”ì²­ì€ ìºì‹œ ì‚¬ìš©
- í‰ê·  ì¶”ê°€ ì§€ì—°: **0.015ms/ìš”ì²­** (ë¬´ì‹œ ê°€ëŠ¥í•œ ìˆ˜ì¤€)

### Connection Poolê³¼ì˜ ê´€ê³„

ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, DNS ì¡°íšŒëŠ” **ìƒˆë¡œìš´ ì»¤ë„¥ì…˜ì„ ìƒì„±í•  ë•Œë§Œ** ë°œìƒí•œë‹¤.

```mermaid
sequenceDiagram
    participant App as Application
    participant Pool as Connection Pool
    participant DNS as DNS Cache
    participant DB as Database

    Note over App,DB: ì´ˆê¸°í™” ë‹¨ê³„
    App->>Pool: Pool ì´ˆê¸°í™” (10ê°œ ì»¤ë„¥ì…˜)
    loop 10ê°œ ì»¤ë„¥ì…˜ ìƒì„±
        Pool->>DNS: DNS ì¡°íšŒ
        DNS-->>Pool: IP ì£¼ì†Œ
        Pool->>DB: ì»¤ë„¥ì…˜ ìƒì„±
    end

    Note over App,DB: ìš´ì˜ ì¤‘ (ëŒ€ë¶€ë¶„ì˜ ìš”ì²­)
    App->>Pool: ì»¤ë„¥ì…˜ ìš”ì²­
    Pool-->>App: ê¸°ì¡´ ì»¤ë„¥ì…˜ ë°˜í™˜ (DNS ì¡°íšŒ ì—†ìŒ)
    App->>DB: SQL ì‹¤í–‰
    DB-->>App: ê²°ê³¼
    App->>Pool: ì»¤ë„¥ì…˜ ë°˜í™˜

    Note over App,DB: ìƒˆ ì»¤ë„¥ì…˜ í•„ìš” ì‹œ
    App->>Pool: ì»¤ë„¥ì…˜ ìš”ì²­
    Pool->>DNS: DNS ì¡°íšŒ (1ì´ˆë§ˆë‹¤ 1íšŒë§Œ)
    DNS-->>Pool: IP ì£¼ì†Œ
    Pool->>DB: ìƒˆ ì»¤ë„¥ì…˜ ìƒì„±
```
